{"version":3,"sources":["Frame.jsx","App.jsx","index.jsx"],"names":["Mat","Frame","animate","_this","renderScene","frameId","window","requestAnimationFrame","_this2","this","script","document","createElement","src","async","onload","Ammo","then","lib","loadThree","body","appendChild","materials","matType","array","i","length","m","THREE","copy","needsUpdate","push","_this3","width","mount","clientWidth","height","clientHeight","modelUrl","concat","props","model","motionUrls","motions","map","clock","camera","position","z","scene","background","gridHelper","y","add","ambient","directionalLight","set","normalize","renderer","antialias","setClearColor","setSize","domElement","controls","OrbitControls","helper","MMDAnimationHelper","afterglow","loader","MMDLoader","loadWithAnimation","mesh","x","modelX","modelY","modelZ","material","convertMaterials","animation","physics","ikHelper","objects","get","ikSolver","createHelper","visible","physicsHelper","start","stop","removeChild","cancelAnimationFrame","update","getDelta","render","_this4","react_default","a","style","padding","margin","ref","React","Component","App","src_Frame","params","URLSearchParams","location","search","ReactDOM","src_App","getElementById"],"mappings":"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","file":"static/js/main.d90e937f.chunk.js","sourcesContent":["import React from 'react';\nimport * as THREE from 'three';\nimport { MMDLoader } from 'three/examples/jsm/loaders/MMDLoader';\nimport { MMDAnimationHelper } from 'three/examples/jsm/animation/MMDAnimationHelper';\nimport { OrbitControls } from 'three/examples/jsm/controls/OrbitControls';\n\nconst Mat = {\n  TOON: 0,\n  STD: 1,\n  PHYS: 2,\n  PHONG: 3\n};\n\nclass Frame extends React.Component {\n  componentDidMount() {\n    const script = document.createElement('script');\n    script.src = 'js/ammo.js';\n    script.async = true;\n    script.onload = () => {\n      window.Ammo().then(lib => {\n        window.Ammo = lib;\n        this.loadThree();\n        this.animate();\n      });\n    };\n    document.body.appendChild(script);\n  }\n\n  convertMaterials(materials, matType) {\n    let array = [];\n    for (let i = 0; i < materials.length; i++) {\n      let m = null;\n      switch (matType) {\n        case Mat.TOON:\n          m = new THREE.MeshToonMaterial();\n          break;\n        case Mat.STD:\n          m = new THREE.MeshStandardMaterial();\n          break;\n        case Mat.PHYS:\n          m = new THREE.MeshPhysicalMaterial();\n          break;\n        default:\n          m = new THREE.MeshPhongMaterial();\n      }\n      m.copy(materials[i]);\n      m.needsUpdate = true;\n      array.push(m);\n    }\n    return array;\n  }\n\n  loadThree() {\n    const width = this.mount.clientWidth;\n    const height = this.mount.clientHeight;\n    this.modelUrl = `pmx/${this.props.model}/model.pmx`;\n    this.motionUrls = this.props.motions.map(m => `vmd/${m}.vmd`);\n\n    // Camera\n    this.clock = new THREE.Clock();\n    this.camera = new THREE.PerspectiveCamera(45, width/height, 1, 2000);\n    this.camera.position.z = 30;\n\n    // Scene\n    this.scene = new THREE.Scene();\n    this.scene.background = new THREE.Color(0xd1cdb7);\n\n    this.gridHelper = new THREE.PolarGridHelper(30, 10);\n    this.gridHelper.position.y = -10;\n    this.scene.add(this.gridHelper);\n\n    this.ambient = new THREE.AmbientLight(0x666666);\n    this.scene.add(this.ambient);\n\n    this.directionalLight = new THREE.DirectionalLight(0x887766);\n    this.directionalLight.position.set(-1, 1, 1).normalize();\n    this.scene.add(this.directionalLight);\n\n    // Renderer\n    this.renderer = new THREE.WebGLRenderer({antialias: true});\n    this.renderer.setClearColor('#000000');\n    this.renderer.setSize(width, height);\n    this.mount.appendChild(this.renderer.domElement);\n    this.controls = new OrbitControls(this.camera, this.renderer.domElement);\n\n    // Model\n    this.helper = new MMDAnimationHelper({afterglow: 2.0});\n    this.loader = new MMDLoader();\n    this.loader.loadWithAnimation(this.modelUrl, this.motionUrls, model => {\n      this.mesh = model.mesh;\n      this.mesh.position.x = this.props.modelX || 0;\n      this.mesh.position.y = this.props.modelY || -10;\n      this.mesh.position.z = this.props.modelZ || 0;\n      this.mesh.material = this.convertMaterials(this.mesh.material, Mat.PHONG);\n      this.scene.add(this.mesh);\n      this.helper.add(this.mesh, {animation: model.animation, physics: true});\n\n      this.ikHelper = this.helper.objects.get(this.mesh).ikSolver.createHelper();\n      this.ikHelper.visible = false;\n      this.scene.add(this.ikHelper);\n\n      this.physicsHelper = this.helper.objects.get(this.mesh).physics.createHelper();\n      this.physicsHelper.visible = false;\n      this.scene.add(this.physicsHelper);\n\n      this.start();\n    }, () => null, null);\n  }\n\n  componentWillUnmount() {\n    this.stop();\n    this.mount.removeChild(this.renderer.domElement);\n  }\n\n  start() {\n    if (!this.frameId) {\n      this.frameId = requestAnimationFrame(this.animate);\n    }\n  }\n\n  stop() {\n    cancelAnimationFrame(this.frameId);\n  }\n\n  animate = () => {\n    this.renderScene();\n    this.frameId = window.requestAnimationFrame(this.animate);\n  }\n\n  renderScene() {\n    this.helper.update(this.clock.getDelta());\n    this.renderer.render(this.scene, this.camera);\n  }\n\n  render() {\n    return(<div\n      style={{width: '800px', height: '600px', padding: '0', margin: 'auto'}}\n      ref={mount => {this.mount = mount;}}\n    />);\n  }\n}\n\nexport default Frame;\n","import React from 'react';\nimport Frame from './Frame';\n\nclass App extends React.Component {\n  render() {\n    if (this.props.model === 'liliya') return <Frame\n      model={'liliya'}\n      motions={['wavefile']}\n    />;\n    if (this.props.model === 'rozaliya') return <Frame\n      model={'rozaliya'}\n      motions={['wavefile']}\n    />;\n    if (this.props.model === 'seele') return <Frame\n      model={'seele'}\n      motions={['senbonzakura']}\n    />;\n    return <Frame\n      model={'wendy'}\n      motions={['sweetmagic-lip', 'sweetmagic-left']}\n      modelX={10}\n    />;\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\n\nimport './index.css';\nimport 'yorha/dist/yorha.min.css';\n\nconst params = new URLSearchParams(window.location.search);\nReactDOM.render(<App model={params.get('model')}/>, document.getElementById('root'));\n"],"sourceRoot":""}